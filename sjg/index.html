<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:10px;
}
h2 { margin-bottom:15px; text-align:center; }

.gallery {
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(150px,1fr));
  gap:10px;
  width:100%;
  max-width:1400px;
}

.gallery img {
  width:100%;
  height:auto;
  border-radius:10px;
  cursor:pointer;
  object-fit:cover;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  transition: transform 0.3s;
}
.gallery img:hover { transform: scale(1.03); }

.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  justify-content:center;
  align-items:center;
  z-index:1000;
  padding:10px;
}
.modal.active { display:flex; }

.modal img {
  max-width:100%;
  max-height:100%;
  border-radius:10px;
  object-fit:contain;
}

.counter {
  position:fixed;
  bottom:15px;
  left:50%;
  transform:translateX(-50%);
  background: rgba(0,0,0,0.5);
  color:#fff;
  padding:6px 12px;
  border-radius:50px;
  display:none;
  font-size:14px;
}

@media (max-width:768px) {
  .gallery { grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); gap:8px; }
  .counter { font-size:12px; padding:4px 8px; }
}
</style>
</head>
<body>


<div class="gallery" id="gallery"></div>
<div id="sentinel"></div>

<div class="modal" id="modal">
  <img id="modalImg" src="" alt="">
</div>
<div class="counter" id="counter">1 / 125</div>

<script>
const gallery = document.getElementById('gallery');
const modal = document.getElementById('modal');
const modalImg = document.getElementById('modalImg');
const counter = document.getElementById('counter');
const sentinel = document.getElementById('sentinel');

const totalImages = 125;
let loadedImages = 0;
const batchSize = 20;
const imgsArray = [];
let currentIndex = 0;

// Cargar imágenes por lotes
function loadImages() {
  if(loadedImages >= totalImages) return;
  const frag = document.createDocumentFragment();
  const next = Math.min(loadedImages + batchSize, totalImages);
  for(let i=loadedImages+1;i<=next;i++){
    const img = document.createElement('img');
    img.src = `imagenes/imagen${i}.jpeg`;
    img.loading='lazy';
    img.alt=`Imagen ${i}`;
    img.dataset.index = i-1;
    img.addEventListener('click', (e)=>{
      openModal(parseInt(e.currentTarget.dataset.index));
    });
    frag.appendChild(img);
    imgsArray.push(img);
  }
  gallery.appendChild(frag);
  loadedImages = next;
}

// Infinite scroll
const io = new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting) loadImages();
  });
},{root:null, rootMargin:'200px', threshold:0});

io.observe(sentinel);

// Modal
function openModal(idx){
  currentIndex = idx;
  modalImg.src = imgsArray[currentIndex].src;
  modal.classList.add('active');
  counter.style.display='block';
  counter.textContent = `${currentIndex+1} / ${totalImages}`;
}

function closeModal(){
  modal.classList.remove('active');
  counter.style.display='none';
}

modal.addEventListener('click', closeModal);

// Navegación con teclado
document.addEventListener('keydown', e=>{
  if(!modal.classList.contains('active')) return;
  if(e.key==='ArrowRight' && currentIndex < loadedImages-1){
    currentIndex++;
    modalImg.src = imgsArray[currentIndex].src;
  }
  if(e.key==='ArrowLeft' && currentIndex > 0){
    currentIndex--;
    modalImg.src = imgsArray[currentIndex].src;
  }
  if(e.key==='Escape') closeModal();
  counter.textContent = `${currentIndex+1} / ${totalImages}`;
});

// Swipe táctil para móviles
let touchStartX = 0;
let touchEndX = 0;

modalImg.addEventListener('touchstart', e => {
  touchStartX = e.changedTouches[0].screenX;
});

modalImg.addEventListener('touchend', e => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
});

function handleSwipe() {
  const diff = touchEndX - touchStartX;
  if(Math.abs(diff) > 50) { // mínimo swipe
    if(diff < 0 && currentIndex < loadedImages-1) { // swipe izquierda
      currentIndex++;
    } else if(diff > 0 && currentIndex > 0) { // swipe derecha
      currentIndex--;
    }
    modalImg.src = imgsArray[currentIndex].src;
    counter.textContent = `${currentIndex+1} / ${totalImages}`;
  }
}

// Carga inicial
loadImages();
</script>

</body>
</html>

